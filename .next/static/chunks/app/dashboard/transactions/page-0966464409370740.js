(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2563],{45975:(e,t,a)=>{Promise.resolve().then(a.bind(a,51188))},51188:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(95155),r=a(12115),i=a(11032),l=a(36268),n=a(55430),o=a(8076),c=a(26597),d=a(76118),x=a(10351);function m(e){let{status:t}=e;return(0,s.jsx)("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full border ".concat({Completed:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800",Pending:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800",Failed:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800"}[t]||"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700"),children:t})}var g=a(91541);let h=(e,t,a)=>{let s=a.toLowerCase();return[e.original.id.toLowerCase(),e.original.date.toLowerCase(),e.original.formattedDate.toLowerCase(),e.original.status.toLowerCase(),e.original.description.toLowerCase(),e.original.serviceName.toLowerCase(),e.original.amount.toString(),e.original.token?e.original.token.toLowerCase():""].some(e=>e.includes(s))},u=e=>{let t=new c.Ay;t.setFontSize(16),t.text("Transaction Receipt - ".concat(e.id),20,20),(0,d.Ay)(t,{startY:30,head:[["Field","Value"]],body:[["Transaction ID",e.id],["Date",e.formattedDate],["Service",e.serviceName],["Status",e.status],["Amount","RWF ".concat(e.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))],["Token",e.token||"N/A"],["Description",e.description]],theme:"grid",headStyles:{fillColor:[255,102,0],textColor:255}}),t.save("Receipt_".concat(e.id,".pdf"))},y=e=>{let{transaction:t,isOpen:a,onClose:r}=e;return a&&t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm",children:(0,s.jsxs)(n.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white dark:bg-gray-900 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Transaction Details"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ID: ",t.id]})]}),(0,s.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:(0,s.jsx)(x.yGN,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),(0,s.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white border-b pb-2",children:"Basic Information"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Transaction ID"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 dark:text-white font-mono",children:t.id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Date & Time"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 dark:text-white",children:t.formattedDate}),t.processDate&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Processed: ",t.formattedProcessDate]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Service"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 dark:text-white capitalize",children:t.serviceName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(m,{status:t.status})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white border-b pb-2",children:"Financial Details"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Amount"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-800 dark:text-white",children:["RWF ",t.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),t.customerCharge>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Customer Charge"}),(0,s.jsxs)("p",{className:"text-sm text-gray-800 dark:text-white",children:["RWF ",t.customerCharge.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),t.token&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Token"}),(0,s.jsx)("p",{className:"text-sm text-gray-800 dark:text-white font-mono break-all",children:t.token})]})]})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white border-b pb-2",children:"Description"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 leading-relaxed",children:t.description})]})]})}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Close"}),(0,s.jsxs)("button",{onClick:()=>{u(t),r()},className:"px-4 py-2 text-sm font-medium text-white bg-[#ff6600] rounded-lg hover:bg-[#e65c00] transition-colors flex items-center gap-2",children:[(0,s.jsx)(x.Mvz,{className:"w-4 h-4"}),"Print Receipt"]})]})]})}):null};function p(){let[e,t]=(0,r.useState)(""),[a,c]=(0,r.useState)([]),[d,p]=(0,r.useState)(!0),[b,f]=(0,r.useState)(""),[j,w]=(0,r.useState)(!1),[k,N]=(0,r.useState)(null),[v,S]=(0,r.useState)(!1),C=e=>{N(e),S(!0)},D=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?w(!0):p(!0),f("");try{let e=g.Z.getAccessToken();if(!e)throw Error("Authentication required. Please login again.");let t=null,a=null;for(let s of["http://localhost:4000/v1/agency/thirdpartyagency/services/transactions/history","http://localhost:4000/v1/agency/thirdpartyagency/transactions/history","http://localhost:4000/v1/agency/transactions/history","http://localhost:4000/v1/transactions/history"])try{if(console.log("Trying endpoint: ".concat(s)),(t=await fetch(s,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).ok){let e=await t.json();if(e.success)return void c(e.data||[]);a=Error(e.message||"Failed to fetch transactions")}else if(404!==t.status)throw Error("HTTP error! status: ".concat(t.status))}catch(e){a=e}throw a||Error("All endpoints failed. Please check the API URL.")}catch(e){f(e.message||"Failed to fetch transactions"),console.error("Error fetching transactions:",e)}finally{p(!1),w(!1)}};(0,r.useEffect)(()=>{D()},[]);let A=(0,i.FB)(),E=[A.accessor("id",{header:"Tx ID",cell:e=>(0,s.jsx)("span",{className:"font-mono text-xs sm:text-sm",children:e.getValue()}),size:100}),A.accessor("formattedDate",{header:"Date",cell:e=>(0,s.jsx)("span",{className:"whitespace-nowrap text-xs sm:text-sm",children:e.getValue()}),size:110}),A.accessor("serviceName",{header:"Service",cell:e=>(0,s.jsx)("span",{className:"truncate block text-xs sm:text-sm capitalize",children:e.getValue()}),size:120}),A.accessor("status",{header:"Status",cell:e=>(0,s.jsx)(m,{status:e.getValue()}),size:100}),A.accessor("amount",{header:"Amount (RWF)",cell:e=>(0,s.jsx)("span",{className:"font-medium whitespace-nowrap text-xs sm:text-sm",children:e.getValue().toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),size:120}),A.accessor("token",{header:"Token",cell:e=>(0,s.jsx)("span",{className:"font-mono text-xs sm:text-sm truncate block",children:e.getValue()||"N/A"}),size:120}),A.accessor("description",{header:"Description",cell:e=>(0,s.jsx)("span",{className:"truncate block text-xs sm:text-sm",children:e.getValue()}),size:150}),A.display({id:"actions",header:"Actions",cell:e=>{let{row:t}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>C(t.original),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 flex items-center gap-1 text-xs sm:text-sm",title:"View Details",children:[(0,s.jsx)(x.Vap,{className:"text-xs sm:text-sm"}),(0,s.jsx)("span",{className:"hidden xs:inline",children:"View"})]}),(0,s.jsxs)("button",{onClick:()=>u(t.original),className:"text-[#ff6600] hover:text-[#e65c00] flex items-center gap-1 text-xs sm:text-sm",title:"Print Receipt",children:[(0,s.jsx)(x.Mvz,{className:"text-xs sm:text-sm"}),(0,s.jsx)("span",{className:"hidden xs:inline",children:"Print"})]})]})},size:120})],T=(0,l.N4)({data:a,columns:E,state:{globalFilter:e,pagination:{pageSize:8,pageIndex:0}},onGlobalFilterChange:t,globalFilterFn:h,getCoreRowModel:(0,i.HT)(),getFilteredRowModel:(0,i.hM)(),getPaginationRowModel:(0,i.kW)()});return d?(0,s.jsx)("div",{className:"p-3 sm:p-4 md:p-6 bg-white dark:bg-gray-950 transition-colors w-full max-w-full overflow-x-hidden min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(x.jTZ,{className:"w-8 h-8 animate-spin text-[#ff6600] mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading transactions..."})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-3 sm:p-4 md:p-6 bg-white dark:bg-gray-950 transition-colors w-full max-w-full overflow-x-hidden",children:[(0,s.jsx)("div",{className:"mb-4 sm:mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-white",children:"Transaction History"}),(0,s.jsx)("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"View and manage your payment transactions"}),b&&(0,s.jsx)("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,s.jsxs)("p",{className:"text-yellow-700 dark:text-yellow-300 text-xs",children:[b," - Showing sample data for demonstration"]})})]}),(0,s.jsxs)("button",{onClick:()=>{D(!0)},disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-[#13294b] dark:bg-[#ff6600] text-white rounded-xl hover:bg-[#0f213d] dark:hover:bg-[#e65c00] transition-colors disabled:opacity-50 text-sm",children:[(0,s.jsx)(x.jTZ,{className:"w-4 h-4 ".concat(j?"animate-spin":"")}),j?"Refreshing...":"Refresh"]})]})}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3",children:[(0,s.jsxs)("div",{className:"relative w-full sm:max-w-md",children:[(0,s.jsx)(x.CKj,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"}),(0,s.jsx)("input",{value:e,onChange:e=>t(e.target.value),placeholder:"Search transactions...",className:"border rounded-lg sm:rounded-xl pl-9 pr-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#ff6600] dark:bg-gray-800 dark:text-white dark:border-gray-700 text-sm sm:text-base"})]}),(0,s.jsxs)(o.CSVLink,{data:T.getFilteredRowModel().rows.map(e=>e.original),filename:"transactions.csv",className:"bg-[#ff6600] hover:bg-[#e65c00] text-white px-3 sm:px-5 py-2 rounded-lg sm:rounded-xl transition flex items-center gap-2 text-sm w-full sm:w-auto justify-center",children:[(0,s.jsx)(x.a4x,{className:"text-sm"}),(0,s.jsx)("span",{children:"Export CSV"})]})]}),e&&(0,s.jsxs)("div",{className:"mb-3 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[T.getFilteredRowModel().rows.length," transaction(s) found"]}),(0,s.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"overflow-x-auto bg-white/70 dark:bg-black/40 backdrop-blur-md shadow-lg rounded-xl border border-gray-200 dark:border-gray-700 w-full",children:(0,s.jsxs)("table",{className:"w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{className:"bg-gray-100 dark:bg-gray-800",children:T.getHeaderGroups().map(e=>(0,s.jsx)("tr",{children:e.headers.map(e=>(0,s.jsx)("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap",style:{width:"".concat(e.getSize(),"px"),minWidth:"".concat(e.getSize(),"px"),maxWidth:"".concat(e.getSize(),"px")},children:(0,l.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,s.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:T.getRowModel().rows.length>0?T.getRowModel().rows.map(e=>(0,s.jsx)(n.P.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:e.getVisibleCells().map(e=>(0,s.jsx)("td",{className:"px-2 py-3 text-xs sm:text-sm text-gray-800 dark:text-gray-200 whitespace-nowrap",style:{width:"".concat(e.column.getSize(),"px"),minWidth:"".concat(e.column.getSize(),"px"),maxWidth:"".concat(e.column.getSize(),"px")},children:(0,l.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:E.length,className:"px-4 py-6 text-center text-gray-500 dark:text-gray-400 text-sm",children:0===a.length?"No transactions found.":"No transactions match your search."})})})]})}),T.getFilteredRowModel().rows.length>0&&(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-4 sm:mt-6 gap-3",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Showing ",T.getRowModel().rows.length," of ",T.getFilteredRowModel().rows.length," entries"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>T.previousPage(),disabled:!T.getCanPreviousPage(),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 hover:bg-gray-100 dark:hover:bg-gray-800 text-sm flex items-center gap-1",title:"Previous page",children:[(0,s.jsx)(x.irw,{className:"text-sm"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Previous"})]}),(0,s.jsxs)("span",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300 px-2",children:["Page ",T.getState().pagination.pageIndex+1," of ",T.getPageCount()]}),(0,s.jsxs)("button",{onClick:()=>T.nextPage(),disabled:!T.getCanNextPage(),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 hover:bg-gray-100 dark:hover:bg-gray-800 text-sm flex items-center gap-1",title:"Next page",children:[(0,s.jsx)("span",{className:"hidden sm:inline",children:"Next"}),(0,s.jsx)(x.fOo,{className:"text-sm"})]})]})]}),(0,s.jsx)("div",{className:"block lg:hidden mt-4",children:(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Scroll horizontally to view all columns →"})})]}),(0,s.jsx)(y,{transaction:k,isOpen:v,onClose:()=>{S(!1),N(null)}})]})}},91541:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,AuthProvider:()=>c,Z:()=>o});var s=a(95155),r=a(12115),i=a(35695);let l=(0,r.createContext)(void 0);class n{encrypt(e){try{return btoa(encodeURIComponent(e))}catch(e){throw Error("Encryption failed")}}decrypt(e){try{return decodeURIComponent(atob(e))}catch(e){throw this.clearUserData(),Error("Invalid token data")}}setUserData(e){try{let t={accessToken:e.accessToken,refreshToken:e.refreshToken,expiresAt:Date.now()+36e5},a=this.encrypt(JSON.stringify(t));sessionStorage.setItem(this.ACCESS_TOKEN_KEY,a);let{accessToken:s,refreshToken:r,...i}=e,l=this.encrypt(JSON.stringify(i));sessionStorage.setItem(this.USER_DATA_KEY,l)}catch(e){this.clearUserData()}}getUserData(){try{let e=sessionStorage.getItem(this.USER_DATA_KEY);if(!e)return null;return JSON.parse(this.decrypt(e))}catch(e){return this.clearUserData(),null}}getAccessToken(){try{let e=sessionStorage.getItem(this.ACCESS_TOKEN_KEY);if(!e)return null;let t=JSON.parse(this.decrypt(e));if(Date.now()>t.expiresAt)return this.clearUserData(),null;return t.accessToken}catch(e){return this.clearUserData(),null}}clearUserData(){sessionStorage.removeItem(this.ACCESS_TOKEN_KEY),sessionStorage.removeItem(this.USER_DATA_KEY)}isAuthenticated(){return!!this.getAccessToken()}constructor(){this.ACCESS_TOKEN_KEY="at",this.USER_DATA_KEY="ud"}}let o=new n;function c(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),x=(0,i.useRouter)();(0,r.useEffect)(()=>{setTimeout(()=>{try{let e=o.getUserData();o.isAuthenticated()&&e?n(e):(o.clearUserData(),n(null))}catch(e){o.clearUserData(),n(null)}finally{d(!1)}},100)},[]);let m={user:a,isLoading:c,isAuthenticated:!!a&&o.isAuthenticated(),login:e=>{o.setUserData(e),n(e)},logout:()=>{o.clearUserData(),n(null),x.push("/login")}};return(0,s.jsx)(l.Provider,{value:m,children:t})}function d(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[844,3930,5430,1805,8441,1317,7358],()=>t(45975)),_N_E=e.O()}]);